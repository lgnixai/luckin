<!doctype html>
<meta charset="utf-8" />
<title>Example Plugin Demo</title>
<script type="module">
  import { HostClient } from "../../sdk/js/client.js";
  const client = new HostClient({ baseUrl: "http://localhost:8080", pluginId: "example.hello" });

  async function init() {
    const out = document.getElementById('out');
    try {
      await client.writeFile("examples/hello.txt", "Hello from plugin demo!\n");
      const files = await client.listFiles();
      out.textContent = JSON.stringify(files, null, 2);
    } catch (e) {
      out.textContent = e.message;
    }

    // Register a command
    try {
      await client.rpc('commands.register', { id: 'say-hello', title: 'Say Hello' });
    } catch (e) {}

    // Subscribe to events
    const es = new EventSource('http://localhost:8080/events');
    es.onmessage = (ev) => {
      const data = JSON.parse(ev.data);
      console.log('event', data);
    };
  }
  init();
  window.invoke = async () => {
    try {
      await client.rpc('commands.invoke', { id: 'say-hello' });
      alert('Invoked');
    } catch (e) {
      alert(e.message);
    }
  };
  window.readHello = async () => {
    try {
      const res = await client.readFile('examples/hello.txt');
      alert(res.content);
    } catch (e) {
      alert(e.message);
    }
  };
</script>
<h1>Example Plugin Demo</h1>
<button onclick="invoke()">Invoke Command</button>
<button onclick="readHello()">Read File</button>
<pre id="out"></pre>

